# 🎣 钓鱼佬的工具箱 (Angler's Toolbox) - SillyTavern Termux 管理脚本

> **作者**: 10091009mc
>
> **⚠️ 警告**: 不要买任何贩子的模型API，都是骗人的！
>
> **🚫 声明**: 本脚本完全免费，仅供个人学习使用，**严禁商业化使用**！

这是一个专为 Android Termux 用户设计的 SillyTavern (酒馆) 一站式管理脚本。它集成了安装、更新、备份、修复以及防杀后台等实用功能，旨在简化手机端部署和维护 SillyTavern 的流程。

## 🚀 快速开始

在 Termux 中复制并运行以下命令即可（脚本会自动安装所需依赖）：

```bash
bash <(curl -s https://raw.githubusercontent.com/mc10091009/st_manager.sh/main/angler_toolbox.sh)
```

## ✨ 核心功能

### 🚀 基础管理

- **一键安装**: 自动检测环境，安装 Node.js, Git 等必要组件，并克隆 SillyTavern 仓库。
- **一键启动**: 启动 SillyTavern 服务，自动检查端口占用。
- **版本更新**: 支持更新到最新版 (Latest) 或切换到指定的 Release 版本。
- **版本回退**: 支持按版本号 (Tag) 或 Commit Hash 自由切换版本，方便回退到稳定版。

### 🛠️ 维护与修复

- **重装依赖**: 针对 `npm install` 失败或报错的情况，提供一键清理并重新安装 `node_modules` 的功能。
- **端口清理**: 自动检测 8000 端口占用情况，支持一键杀掉占用进程（解决 "EADDRINUSE" 错误）。
- **数据备份**: 将 `data`, `config.yaml`, `secrets.json` 及第三方插件打包备份到 `~/st_backups`。
- **数据恢复**: 支持从备份文件一键还原数据，重装也不怕丢配置。

### 🛡️ 防杀后台保活 (无需电脑)

针对 Android 系统杀后台严重的问题，提供多种**纯手机端**保活方案，无需连接电脑或 ADB：

- **唤醒锁 (Wake Lock)**: 调用 Termux API 申请唤醒锁，防止手机休眠。
- **静音音频保活**: 在后台循环播放 0dB 静音音频，欺骗系统认为有媒体正在播放，从而避免被杀（需安装 `Termux:API` 应用）。
- **电池优化设置**: 快速跳转系统设置，方便手动关闭 Termux 的电池优化。
- **系统设置指南**: 内置详细的图文指引，教你如何设置“最近任务锁定”、“悬浮窗权限”和“自启动管理”。

### ⚙️ 其他功能

- **开机自启**: 可设置 Termux 启动时自动运行此脚本，方便快捷。
- **脚本更新**: 在线检测并更新脚本自身到最新版本。
- **卸载管理**: 支持卸载 SillyTavern、卸载脚本或一键清理所有相关文件。

## 📦 依赖说明

脚本会自动检查并安装以下 Termux 包：

- `curl`, `git`, `nodejs`, `python`, `tar`, `jq`, `lsof`, `psmisc` (fuser), `procps` (pgrep), `termux-api`

**注意**: 使用“静音音频保活”功能需要额外安装 [Termux:API](https://f-droid.org/packages/com.termux.api/) 安卓应用。

## ❓ 常见问题

**Q: 脚本启动后需要退出两次才能关闭？**
A: 这是一个已知问题，已在 v1.2.7+ 版本中修复。请使用脚本内的“更新此脚本”功能升级，脚本会自动检测并修复重复的自启动配置。

**Q: `npm install` 一直失败怎么办？**
A: 请检查网络连接，或者尝试使用脚本菜单中的“重装依赖 (Fix npm)”功能。

**Q: 保活功能真的有用吗？**
A: Android 系统碎片化严重，不同厂商（小米、华为、三星等）的杀后台策略不同。脚本提供的方案是目前无需 Root/ADB 的最佳实践，建议组合使用（如：开启唤醒锁 + 锁定最近任务 + 允许自启动）。

## 📜 更新日志

- **v1.2.7**:
  - 修复自启动导致的“双重退出”Bug。
  - 移除所有需要电脑/ADB 的保活方法，全面转向纯手机端方案。
  - 新增静音音频保活和系统设置指南。
- **v1.2.0**: 重构菜单界面，增加分类。
- **v1.0.0**: 初始版本发布。

---
*Enjoy your SillyTavern on Android!* 🎣
